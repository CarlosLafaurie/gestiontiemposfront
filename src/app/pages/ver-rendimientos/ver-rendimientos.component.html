<app-navbar></app-navbar>
<app-boton-regresar></app-boton-regresar>

<div class="inventario-admin">
  <h2 id="title">Resumen de Rendimientos</h2>

  <div class="search-container">
    <input
      [(ngModel)]="searchQuery"
      (input)="filtrarRendimientos()"
      class="search-input"
      placeholder="Buscar por nombre u obra"
    />
  </div>

  <div class="table-responsive">
    <table class="table">
      <thead>
        <tr>
          <th>#</th>
          <th>Empleado</th>
          <th>Obra</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let emp of resumenRendimientos; let i = index">
          <tr>
            <td>{{ i + 1 }}</td>
            <td>{{ emp.nombreEmpleado }}</td>
            <td>{{ emp.nombreObra }}</td>
            <td>
              <button class="btn btn-info" (click)="toggleActividades(emp.idEmpleado)">
                {{ emp.mostrar ? 'Ocultar actividades' : 'Ver actividades' }}
              </button>
            </td>
          </tr>

          <ng-container *ngIf="emp.mostrar">
            <tr>
              <td colspan="4">
                <div class="table-responsive">
                  <table
                    class="table table-sm table-bordered table-light"
                    *ngIf="emp.actividades && emp.actividades.length > 0; else sinActividades"
                  >
                    <thead>
                      <tr>
                        <th>Actividad</th>
                        <th>Unidad</th>
                        <th>Total Cantidad</th>
                        <th>Total DÃ­as</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let act of emp.actividades">
                        <td>{{ act.actividad }}</td>
                        <td>{{ act.unidad }}</td>
                        <td>{{ act.totalCantidad }}</td>
                        <td>{{ act.totalDias }}</td>
                      </tr>
                    </tbody>
                  </table>

                  <ng-template #sinActividades>
                    <p class="mensaje-info">No hay actividades registradas.</p>
                  </ng-template>
                </div>
              </td>
            </tr>
          </ng-container>
        </ng-container>
      </tbody>
    </table>
  </div>
</div>
